@model IEnumerable<SoppSnackis.Models.Post>
@inject Microsoft.AspNetCore.Identity.UserManager<SoppSnackis.Areas.Identity.Data.SoppSnackisUser> UserManager

@if (Model != null && Model.Any())
{
    <ul class="list-group ms-4">
        @foreach (var reply in Model.OrderBy(r => r.CreatedAt))
        {
            <li class="list-group-item">
                <div>
                    <strong>@reply.Author?.UserName</strong>
                    <span class="text-muted small">@reply.CreatedAt.ToString("yyyy-MM-dd HH:mm")</span>
                </div>
                <div>@reply.Text</div>

                <!-- Reply form for this reply -->
                <form method="post" asp-page-handler="Reply" asp-route-parentId="@reply.Id" class="mt-2">
                    <div class="mb-2">
                        <textarea name="NewReply.Text" class="form-control" rows="2" placeholder="Svara på detta inlägg..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-sm btn-secondary">Reply</button>
                </form>

                <!-- Recursive call for further nested replies -->
                @await Html.PartialAsync("_RepliesPartial", reply.Replies)
            </li>
        }
    </ul>
}